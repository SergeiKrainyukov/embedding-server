# ๐ Embedding Server

Kotlin-ัะตัะฒะตั ะดะปั ัะพะทะดะฐะฝะธั ัะตะบััะพะฒัั ัะผะฑะตะดะดะธะฝะณะพะฒ ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ Ollama (nomic-embed-text).

## ๐ ะขัะตะฑะพะฒะฐะฝะธั

- **JDK 17+**
- **Ollama** ั ะผะพะดะตะปัั `nomic-embed-text`

## ๐ ะฃััะฐะฝะพะฒะบะฐ Ollama

```bash
# 1. ะฃััะฐะฝะพะฒะธัั Ollama (ะตัะปะธ ะตัั ะฝะต ัััะฐะฝะพะฒะปะตะฝ)
# macOS/Linux:
curl -fsSL https://ollama.com/install.sh | sh

# 2. ะกะบะฐัะฐัั ะผะพะดะตะปั ะดะปั ัะผะฑะตะดะดะธะฝะณะพะฒ
ollama pull nomic-embed-text

# 3. ะะฐะฟัััะธัั Ollama (ะพะฑััะฝะพ ะทะฐะฟััะบะฐะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ)
ollama serve
```

Ollama ะดะพะปะถะตะฝ ะฑััั ะดะพัััะฟะตะฝ ะฝะฐ `http://localhost:11434`

## ๐ ะะฐะฟััะบ ัะตัะฒะตัะฐ

### ะะฐัะธะฐะฝั 1: Gradle (ัะตะบะพะผะตะฝะดัะตััั)

```bash
cd embedding-server

# Linux/macOS
./gradlew run

# Windows
gradlew.bat run
```

### ะะฐัะธะฐะฝั 2: ะกะฑะพัะบะฐ JAR

```bash
./gradlew build
java -jar build/libs/embedding-server-1.0.0.jar
```

ะกะตัะฒะตั ะทะฐะฟัััะธััั ะฝะฐ **http://localhost:8080**

## ๐ API Endpoints

| ะะตัะพะด | ะััั | ะะฟะธัะฐะฝะธะต |
|-------|------|----------|
| `POST` | `/api/embed` | ะกะพะทะดะฐัั ัะผะฑะตะดะดะธะฝะณ ะธ ัะพััะฐะฝะธัั ะฒ ะะ |
| `POST` | `/api/embed/batch` | ะกะพะทะดะฐัั ัะผะฑะตะดะดะธะฝะณะธ ะดะปั ะฝะตัะบะพะปัะบะธั ัะตะบััะพะฒ |
| `POST` | `/api/embed/query` | ะกะพะทะดะฐัั ัะผะฑะตะดะดะธะฝะณ ะฑะตะท ัะพััะฐะฝะตะฝะธั |
| `POST` | `/api/search` | ะกะตะผะฐะฝัะธัะตัะบะธะน ะฟะพะธัะบ |
| `GET` | `/api/embeddings` | ะะพะปััะธัั ะฒัะต ัะพััะฐะฝัะฝะฝัะต ัะผะฑะตะดะดะธะฝะณะธ |
| `GET` | `/api/embeddings/{id}` | ะะพะปััะธัั ัะผะฑะตะดะดะธะฝะณ ะฟะพ ID |
| `DELETE` | `/api/embeddings/{id}` | ะฃะดะฐะปะธัั ัะผะฑะตะดะดะธะฝะณ |
| `GET` | `/api/health` | ะัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั |
| `GET` | `/api/stats` | ะกัะฐัะธััะธะบะฐ |

## ๐ฏ ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะกะพะทะดะฐัั ัะผะฑะตะดะดะธะฝะณ

```bash
curl -X POST http://localhost:8080/api/embed \
  -H "Content-Type: application/json" \
  -d '{"text": "ะัะธะฒะตั, ะผะธั!"}'
```

**ะัะฒะตั:**
```json
{
  "id": 1,
  "text": "ะัะธะฒะตั, ะผะธั!",
  "embedding": [-0.123, 0.456, -0.789, ...],
  "chunks": null
}
```

### Batch ะพะฑัะฐะฑะพัะบะฐ

```bash
curl -X POST http://localhost:8080/api/embed/batch \
  -H "Content-Type: application/json" \
  -d '{
    "texts": [
      "ะะตัะฒัะน ัะตะบัั",
      "ะัะพัะพะน ัะตะบัั",
      "ะขัะตัะธะน ัะตะบัั"
    ]
  }'
```

### ะกะตะผะฐะฝัะธัะตัะบะธะน ะฟะพะธัะบ

```bash
curl -X POST http://localhost:8080/api/search \
  -H "Content-Type: application/json" \
  -d '{
    "query": "ะผะฐัะธะฝะฝะพะต ะพะฑััะตะฝะธะต",
    "topK": 5
  }'
```

### ะัะพะฒะตัะธัั ะทะดะพัะพะฒัะต

```bash
curl http://localhost:8080/api/health
```

**ะัะฒะตั:**
```json
{
  "status": "healthy",
  "ollama": true,
  "database": true
}
```

## ๐ Swagger UI

ะัะบัะพะนัะต ะฒ ะฑัะฐัะทะตัะต: **http://localhost:8080/swagger**

ะะดะตัั ะผะพะถะฝะพ ะธะฝัะตัะฐะบัะธะฒะฝะพ ัะตััะธัะพะฒะฐัั ะฒัะต API ะผะตัะพะดั.

## โ๏ธ ะะฐัััะพะนะบะธ

| ะะฐัะฐะผะตัั | ะะฝะฐัะตะฝะธะต | ะะฟะธัะฐะฝะธะต |
|----------|----------|----------|
| Chunk size | 500-1000 ัะพะบะตะฝะพะฒ | ะะฐะทะผะตั ัะฐะฝะบะพะฒ ะดะปั ะดะปะธะฝะฝัั ัะตะบััะพะฒ |
| Overlap | 50-100 ัะพะบะตะฝะพะฒ | ะะตัะตะบัััะธะต ะผะตะถะดั ัะฐะฝะบะฐะผะธ |
| Normalization | [-1, 1] | ะะธะฐะฟะฐะทะพะฝ ะฝะพัะผะฐะปะธะทะฐัะธะธ ะฒะตะบัะพัะพะฒ |
| Model | nomic-embed-text | ะะพะดะตะปั Ollama |
| Dimension | 768 | ะะฐะทะผะตัะฝะพััั ัะผะฑะตะดะดะธะฝะณะฐ |

## ๐ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโ
โ   Client    โโโโโโถโ   Ktor      โโโโโโถโ  Ollama     โ
โ  (HTTP)     โ     โ   Server    โ     โ  (LLM)      โ
โโโโโโโโโโโโโโโ     โโโโโโโโฌโโโโโโโ     โโโโโโโโโโโโโโโ
                          โ
                          โผ
                   โโโโโโโโโโโโโโโ
                   โ    H2 DB    โ
                   โ (in-memory) โ
                   โโโโโโโโโโโโโโโ
```

### ะะพะผะฟะพะฝะตะฝัั:

1. **ChunkingService** - ัะฐะทะฑะธะฒะฐะตั ะดะปะธะฝะฝัะต ัะตะบััั ะฝะฐ ัะฐะฝะบะธ ั ะฟะตัะตะบัััะธะตะผ
2. **OllamaClient** - ะฒะทะฐะธะผะพะดะตะนััะฒัะตั ั Ollama API
3. **NormalizationService** - ะฝะพัะผะฐะปะธะทัะตั ะฒะตะบัะพัะฐ ะบ [-1, 1]
4. **EmbeddingRepository** - ััะฐะฝะธั ัะผะฑะตะดะดะธะฝะณะธ ะฒ H2 database
5. **EmbeddingService** - ะพะฑัะตะดะธะฝัะตั ะฒัะต ะบะพะผะฟะพะฝะตะฝัั

## ๐ ะัะธะผะตัะฐะฝะธั

- **ะะฐะทะฐ ะดะฐะฝะฝัั in-memory**: ะดะฐะฝะฝัะต ะฝะต ัะพััะฐะฝััััั ะฟัะธ ะฟะตัะตะทะฐะฟััะบะต ัะตัะฒะตัะฐ
- ะะปั production ัะตะบะพะผะตะฝะดัะตััั ะทะฐะผะตะฝะธัั H2 ะฝะฐ PostgreSQL
- ะะพัั ะฟะพ ัะผะพะปัะฐะฝะธั: 8080
- Ollama ะดะพะปะถะตะฝ ะฑััั ะทะฐะฟััะตะฝ ะดะพ ััะฐััะฐ ัะตัะฒะตัะฐ

## ๐ง ะะพะฝัะธะณััะฐัะธั Ollama

ะัะปะธ Ollama ัะฐะฑะพัะฐะตั ะฝะฐ ะดััะณะพะผ ะฟะพััั ะธะปะธ ัะพััะต, ะธะทะผะตะฝะธัะต ะฒ `OllamaClient.kt`:

```kotlin
class OllamaClient(
    private val baseUrl: String = "http://localhost:11434",  // โ ะธะทะผะตะฝะธัั
    private val model: String = "nomic-embed-text"
)
```

## ๐ ะะธัะตะฝะทะธั

MIT
